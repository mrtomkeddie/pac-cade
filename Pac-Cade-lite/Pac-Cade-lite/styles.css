:root {
  --bg-arcade: #0b0f1a;
  --bg-console: #14120f;
  --neon: #00f5ff;
  --pink: #ff2db2;
  --accent: #ffd166;
  --text: #e6e8ee;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  background: radial-gradient(1000px 500px at 50% -200px, rgba(0,245,255,0.2), transparent 40%), var(--bg-arcade);
  color: var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
}

.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  background: rgba(8,12,20,0.7);
  backdrop-filter: blur(6px);
  position: sticky;
  top: 0;
  z-index: 10;
}
.brand { font-weight: 700; letter-spacing: 0.4px; }
.room-switch { display: flex; gap: 10px; }
.switch-btn {
  background: #121826;
  color: var(--text);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
}
.switch-btn:hover { border-color: var(--neon); box-shadow: 0 0 12px rgba(0,245,255,0.3); }

#view-container { padding: 24px; }
.room-title { font-size: 22px; margin-bottom: 12px; opacity: 0.9; }

.room.hidden, .game-view.hidden, .theme.hidden { display: none; }

/* Arcade Room */
.cabinets-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 16px;
}
.cabinet {
  appearance: none;
  background: transparent;
  border: none;
  padding: 0;
  cursor: pointer;
}
.cabinet-body {
  background: linear-gradient(180deg, #121826 0%, #0b0f1a 70%);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 12px;
  padding: 10px;
  transform: perspective(800px) rotateX(3deg);
  box-shadow: 0 18px 50px rgba(0,0,0,0.6), 0 0 0 2px rgba(0,245,255,0.08) inset;
}
.cabinet-body:hover { border-color: var(--pink); box-shadow: 0 18px 50px rgba(0,0,0,0.6), 0 0 0 2px rgba(255,45,178,0.25) inset; }
.marquee {
  text-align: center;
  padding: 8px;
  background: linear-gradient(90deg, rgba(0,245,255,0.2), rgba(255,45,178,0.2));
  border-radius: 8px;
  font-weight: 600;
}
.screen.placeholder {
  height: 140px;
  margin-top: 10px;
  border-radius: 8px;
  background: radial-gradient(300px 160px at 50% 30%, rgba(0,245,255,0.15), transparent), #0f1422;
  border: 1px solid rgba(255,255,255,0.08);
  display: grid;
  place-items: center;
  color: #9fb1c9;
}

/* Console Room */
.console-scene {
  display: grid;
  grid-template-columns: 1.2fr 1fr;
  gap: 24px;
}
.crt-wrap { position: relative; }
.crt {
  width: 100%;
  height: 340px;
  border-radius: 18px;
  background: #1a1c20;
  border: 2px solid #2a2d33;
  box-shadow: 0 40px 60px rgba(0,0,0,0.6);
  position: relative;
}
.crt-glass { position: absolute; inset: 14px; background: radial-gradient(600px 260px at 50% 20%, rgba(255,255,255,0.08), transparent), #0b0e11; border-radius: 8px; }
.crt-bezel { position: absolute; inset: 0; border-radius: 18px; box-shadow: 0 0 0 6px #15171b inset, 0 0 0 12px #0f1114 inset; }
.console-stand { margin-top: 12px; display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; }
.console-slot { background: #181a1f; border: 1px solid rgba(255,255,255,0.12); padding: 10px; border-radius: 8px; text-align: center; }
.games-shelf { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; align-content: start; }
.game-box { background: linear-gradient(180deg, #23262d, #191c22); border: 1px solid rgba(255,255,255,0.15); border-radius: 10px; padding: 14px; cursor: pointer; text-align: left; }
.game-box:hover { border-color: var(--accent); box-shadow: 0 0 22px rgba(255,209,102,0.25); }

/* Game View */
.view-header {
  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
}
.back-btn, .action-btn {
  background: #121826;
  color: var(--text);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
}
.file-btn { position: relative; overflow: hidden; }
.file-btn input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
.game-title { font-weight: 600; opacity: 0.9; }

.emulator-wrap {
  width: 100%;
  aspect-ratio: var(--emu-aspect, 4 / 3);
  background: #000;
  border: 2px solid #0e1016;
  border-radius: 8px;
  overflow: hidden;
  transition: all 200ms ease-in-out;
  margin: 0 auto;
}
.emulator-wrap iframe { width: 100%; height: 100%; border: 0; display: block; }
.arcade-screen, .crt-frame { transition: all 200ms ease-in-out; }

.is-fullscreen .emulator-wrap {
  aspect-ratio: auto;
  width: 100vw;
  height: 100vh;
  border: none;
  border-radius: 0;
  background: #000;
  display: flex;
  align-items: center;
  justify-content: center;
}
.is-fullscreen .arcade-marquee,
.is-fullscreen .arcade-controls,
.is-fullscreen .console-stand,
.is-fullscreen .tv-stand,
.is-fullscreen .crt,
.is-fullscreen .crt-glass,
.is-fullscreen .crt-bezel { display: none !important; }
.is-fullscreen .topbar { display: none; }
.is-fullscreen #view-container { position: fixed; inset: 0; padding: 0; }
.is-fullscreen .view-header { display: none; }
.is-fullscreen .emulator-wrap > * {
  width: min(100vw, calc(100vh * (var(--emu-aspect-w, 4)/var(--emu-aspect-h, 3))));
  height: min(calc(100vw * (var(--emu-aspect-h, 3)/var(--emu-aspect-w, 4))), 100vh);
}

[data-scale-mode="stretch"] .is-fullscreen .emulator-wrap > * {
  width: 100vw;
  height: 100vh;
}
.is-fullscreen .theme-arcade .arcade-screen { padding: 0; border: none; border-radius: 0; box-shadow: none; }
.is-fullscreen .theme-console .crt-frame { padding: 0; border: none; border-radius: 0; }

.is-fullscreen.has-bezel .emulator-wrap { position: relative; }
.is-fullscreen.has-bezel .emulator-wrap::before,
.is-fullscreen.has-bezel .emulator-wrap::after {
  content: '';
  position: absolute;
  top: 0;
  bottom: 0;
  width: calc((100vw - min(100vw, calc(100vh * (var(--emu-aspect-w, 4)/var(--emu-aspect-h, 3))))) / 2);
  background:
    radial-gradient(20px 20px at 30% 20%, rgba(0,0,0,0.15), transparent 40%) no-repeat,
    radial-gradient(20px 20px at 70% 80%, rgba(0,0,0,0.15), transparent 40%) no-repeat,
    linear-gradient(180deg, var(--bezel-bg, #f6e16b), var(--bezel-bg2, #f2dc5a));
  border-left: 8px solid var(--bezel-stroke, #8f6a00);
  border-right: 8px solid var(--bezel-stroke, #8f6a00);
  box-shadow: inset 0 0 0 6px rgba(0,0,0,0.15);
}
.is-fullscreen.has-bezel .emulator-wrap::before { left: 0; }
.is-fullscreen.has-bezel .emulator-wrap::after { right: 0; }

.is-fullscreen.has-bezel .emulator-wrap::before {
  background-image:
    radial-gradient(24px 24px at 30% 18%, rgba(255,45,178,0.4), transparent 50%),
    radial-gradient(24px 24px at 70% 82%, rgba(0,245,255,0.4), transparent 50%),
    linear-gradient(180deg, var(--bezel-bg, #f6e16b), var(--bezel-bg2, #f2dc5a));
}
.is-fullscreen.has-bezel .emulator-wrap::after {
  background-image:
    radial-gradient(24px 24px at 70% 18%, rgba(255,45,178,0.4), transparent 50%),
    radial-gradient(24px 24px at 30% 82%, rgba(0,245,255,0.4), transparent 50%),
    linear-gradient(180deg, var(--bezel-bg, #f6e16b), var(--bezel-bg2, #f2dc5a));
}

/* Use custom bezel image when available */
.is-fullscreen.has-bezel.bezel-img .emulator-wrap::before,
.is-fullscreen.has-bezel.bezel-img .emulator-wrap::after {
  background: none;
  background-image: var(--bezel-image-url);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  border: none;
  box-shadow: none;
}
.is-fullscreen.has-bezel.bezel-img .emulator-wrap::after { transform: scaleX(-1); transform-origin: center; }

#fullscreen-btn.active { border-color: var(--accent); box-shadow: 0 0 18px rgba(255,209,102,0.35); }

.theme-arcade .arcade-machine { display: grid; grid-template-rows: auto 1fr auto; gap: 10px; }
.theme-arcade .arcade-marquee { background: linear-gradient(90deg, var(--neon), var(--pink)); -webkit-background-clip: text; background-clip: text; color: transparent; font-size: 20px; font-weight: 800; text-align: center; }
.theme-arcade .arcade-screen { background: linear-gradient(180deg, #0b0f1a, #121826); padding: 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 18px 50px rgba(0,0,0,0.6); display: grid; place-items: center; }

.theme-console .crt-tv { display: grid; grid-template-rows: auto auto; gap: 10px; }
.theme-console .crt-frame { background: #14171d; padding: 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); display: grid; place-items: center; }
.theme-console .tv-stand { height: 60px; background: linear-gradient(180deg, #1c1f26, #13161b); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; display: grid; place-items: center; color: #b7c2d1; }

/* Transitions */
.fade-in { animation: fadein 280ms ease-out; }
@keyframes fadein { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }

/* Responsive */
@media (max-width: 980px) {
  .console-scene { grid-template-columns: 1fr; }
}
.fs-controls { position: fixed; top: 14px; left: 0; right: 0; display: flex; gap: 10px; justify-content: center; z-index: 10000; opacity: 0; transform: translateY(-8px); pointer-events: none; transition: opacity 180ms ease, transform 180ms ease; }
.fs-controls.visible { opacity: 1; transform: translateY(0); pointer-events: none; }
.fs-controls .fs-btn { pointer-events: auto; }
.fs-btn { background: rgba(18,24,38,0.9); color: var(--text); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 8px 12px; cursor: pointer; }
.fs-btn:hover { border-color: var(--accent); box-shadow: 0 0 14px rgba(255,209,102,0.25); }

.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.65); display: flex; align-items: center; justify-content: center; z-index: 10001; }
.modal.hidden { display: none; }

.controller-panel { background: rgba(8,12,20,0.7); border: 1px solid rgba(255,255,255,0.12); border-radius: 10px; padding: 12px; margin: 8px 0 16px; backdrop-filter: blur(6px); }
.controller-panel.hidden { display: none; }
.controller-panel .panel-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
.controller-panel .panel-title { font-weight: 600; }
.controller-panel .panel-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 8px; }
.controller-panel .panel-item { background: #121826; border: 1px solid rgba(255,255,255,0.12); border-radius: 8px; padding: 8px; display: grid; gap: 6px; }
.controller-panel .panel-item label { font-size: 12px; opacity: 0.8; }
.controller-panel .panel-item input { background: #0f1422; color: var(--text); border: 1px solid rgba(255,255,255,0.14); border-radius: 6px; padding: 8px; }
.controller-panel .panel-actions { display: flex; justify-content: flex-end; margin-top: 10px; }
.modal-content { width: min(960px, 96vw); max-height: 90vh; overflow: hidden; background: #11151f; border: 1px solid #2a2d33; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
.modal-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-bottom: 1px solid #20232b; }
.modal-title { font-weight: 700; }
.close-btn { background: transparent; color: var(--text); border: none; font-size: 24px; cursor: pointer; }
.tabbar { display: flex; gap: 8px; padding: 10px 16px; border-bottom: 1px solid #20232b; }
.tab-btn { background: #1a1f2b; color: var(--text); border: 1px solid #2a2d33; border-radius: 8px; padding: 8px 12px; cursor: pointer; }
.tab-btn.active { background: #232936; border-color: #3a3f46; }
.tab-content { padding: 12px 16px; max-height: calc(90vh - 120px); overflow: auto; }
.pane-row { display: flex; gap: 8px; align-items: center; margin-bottom: 10px; }
.pane-check { display: flex; align-items: center; gap: 6px; }
.pane-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 8px; }
.list { display: grid; gap: 6px; }
.action-btn { background: #232936; color: var(--text); border: 1px solid #3a3f46; border-radius: 8px; padding: 8px 12px; cursor: pointer; }
.file-btn input { display: none; }
.small-note { font-size: 12px; opacity: 0.8; margin-left: 8px; }
